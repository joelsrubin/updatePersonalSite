<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <meta name="theme-color" content="#967bb6" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <title>Joel Rubin</title>
    <link rel="apple-touch-icon" href="./assets/baseball.png" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main>
      <div class="header_container">
        <h2 class="name">
          <span class="letter">J</span><span class="letter">o</span
          ><span class="letter">e</span><span class="letter">l</span>
          <span class="letter">R</span><span class="letter">u</span
          ><span class="letter">b</span><span class="letter">i</span
          ><span class="letter">n</span>
        </h2>
        <span class="bio">
          Currently at
          <a class="job" href="https://www.sureapp.com" target="_blank">
            SureApp</a
          >
        </span>
      </div>
      <div id="main">
        <span class="link"
          >📧
          <a
            href="mailto:joelsrubin@gmail.com?subject=Hey%20Joel!"
            target="_blank"
            >Email</a
          >
        </span>
        <span class="link"
          >🔗
          <a href="https://github.com/joelsrubin" target="_blank"
            >Github</a
          ></span
        >
        <span class="link"
          >🔗
          <a href="https://www.linkedin.com/in/joel-rubin-0529/" target="_blank"
            >LinkedIn</a
          ></span
        >
        <span class="link">✏️ <a href="guestbook.html">Guestbook</a></span>
        <span class="link"
          >👾
          <a href="https://my-wordle-experience.netlify.app/" target="_blank"
            >Wordle clone</a
          ></span
        >
      </div>
      <footer>
        <div>
          <span class="list-item">👓 views:</span>
          <span class="list-item" id="views">0</span>
        </div>
        <p>&copy;<span id="year">2023</span></p>
      </footer>
    </main>
  </body>
  <script>
    const yearSpan = document.getElementById('year');
    const viewsDiv = document.getElementById('views');

    async function updateViewCount() {
      await fetch('https://api.val.town/v1/run/Joelsrubin.updateViewCount');
    }

    /** @returns {number} */
    async function getViewCount() {
      const data = await fetch(
        'https://api.val.town/v1/run/Joelsrubin.pageViews'
      );
      const result = await data.json();
      return result;
    }

    function animateValue(obj, start, end, duration, easingFunction) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const timeElapsed = timestamp - startTimestamp;
        const progress = Math.min(timeElapsed / duration, 1);
        const easedProgress = easingFunction(progress);
        obj.innerHTML = Math.floor(easedProgress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    // Easing function: easeInOutQuad
    function easeInOutQuad(t) {
      return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
    }

    function setYear() {
      const currentYear = new Date().getFullYear();
      yearSpan.innerHTML = currentYear;
    }

    (async () => {
      setYear();
      await updateViewCount();
      const updated = await getViewCount();
      animateValue(viewsDiv, 0, updated, 4000, easeInOutQuad);
    })();
  </script>
</html>
